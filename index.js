(()=>{(function(){"use strict";var d={};/*!
 * vue-slim-tabs v0.3.0
 * (c) 2017-present egoist <0x142857@gmail.com>
 * Released under the MIT License.
 */Object.defineProperty(d,"__esModule",{value:!0});var _={name:"tabs",props:{defaultIndex:{default:0,type:Number},onSelect:{type:Function}},data:function(){return{selectedIndex:this.defaultIndex}},methods:{switchTab:function(t,s,i){i||(this.selectedIndex=s,this.onSelect&&this.onSelect(t,s))}},render:function(){var t=this,s=arguments[0],i=this.$slots.default.filter(function(l){return l.componentOptions}),o=[];return i.forEach(function(l,u){var c=l.componentOptions.propsData,r=c.title,a=c.titleSlot,p=c.disabled,f=a?t.$slots[a]:r,n=p===!0||p==="";o.push(s("li",{class:"vue-tab",attrs:{role:"tab","aria-selected":t.selectedIndex===u?"true":"false","aria-disabled":n?"true":"false"},on:{click:function(v){return t.switchTab(v,u,n)}}},[f]))}),s("div",{class:"vue-tabs",attrs:{role:"tabs"}},[s("ul",{class:"vue-tablist",attrs:{role:"tablist"}},[this.$slots.left,o,this.$slots.right]),i[this.selectedIndex]])}},m={name:"tab",props:["title","titleSlot","disabled"],render:function(){var t=arguments[0];return t("div",{class:"vue-tabpanel",attrs:{role:"tabpanel"}},[this.$slots.default])}};function C(e){e.component(_.name,_),e.component(m.name,m)}var S=d.Tabs=_,T=d.Tab=m;d.install=C;var F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.data?s("k-textarea-field",{attrs:{label:"Preview",value:e.data,buttons:!1,disabled:"true"}}):s("k-text",[e._v(" "+e._s(e.$t("reporter.tab.preview.empty"))+" ")])},I=[];function h(e,t,s,i,o,l,u,c){var r=typeof e=="function"?e.options:e;t&&(r.render=t,r.staticRenderFns=s,r._compiled=!0),i&&(r.functional=!0),l&&(r._scopeId="data-v-"+l);var a;if(u?(a=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(n=__VUE_SSR_CONTEXT__),o&&o.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(u)},r._ssrRegister=a):o&&(a=c?function(){o.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:o),a)if(r.functional){r._injectStyles=a;var p=r.render;r.render=function(y,v){return a.call(v),p(y,v)}}else{var f=r.beforeCreate;r.beforeCreate=f?[].concat(f,a):[a]}return{exports:e,options:r}}const x={name:"IssuePreview",props:{data:String}},b={};var R=h(x,F,I,!1,O,null,null,null);function O(e){for(let t in b)this[t]=b[t]}var E=function(){return R.exports}(),L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"k-kit-form",on:{input:function(i){return e.somethingChanged()}}},[e.errors.length?s("k-box",{staticClass:"k-kit-form--note",attrs:{theme:"negative"}},[s("k-icon",{attrs:{type:"alert"}}),e._l(e.errors,function(i){return s("p",[e._v(e._s(i))])})],2):e._e(),e.hasResponse?s("k-box",{staticClass:"k-kit-form--note",attrs:{theme:"positive"}},[s("k-icon",{attrs:{type:"check"}}),s("p",{domProps:{innerHTML:e._s(e.successMessage)}})],1):e._e(),s("k-form",[s("k-grid",{staticClass:"title-field"},[s("k-column",[s("k-text-field",{attrs:{name:"title",label:e.$t("reporter.form.field.title"),required:""},model:{value:e.issue.title,callback:function(i){e.$set(e.issue,"title",i)},expression:"issue.title"}})],1)],1),s("tabs",[s("tab",{attrs:{title:e.$t("reporter.tab.write")}},[s("k-fieldset",{attrs:{fields:e.fields},on:{submit:function(i){return i.preventDefault(),e.checkForm.apply(null,arguments)}},model:{value:e.issue.formFields,callback:function(i){e.$set(e.issue,"formFields",i)},expression:"issue.formFields"}})],1),s("tab",{attrs:{title:e.$t("reporter.tab.preview")}},[s("issue-preview",{attrs:{data:e.previewData}})],1)],1),s("k-line-field"),s("k-button",{class:{"is-loading":e.loading},attrs:{disabled:e.loading,icon:e.buttonIcon},on:{click:e.checkForm}},[e._v(" "+e._s(e.$t("reporter.form.button.save"))+" ")])],1)],1)},M=[],K="";const P={name:"IssueForm",components:{IssuePreview:E,Tabs:S,Tab:T},props:{fields:{type:Object},previewData:{type:String}},computed:{hasResponse(){return Object.keys(this.response).length>1},buttonIcon(){return this.loading?"loader":"check"},successMessage(){return this.$t("reporter.form.success",{issueLink:this.issueLink})},issueLink(){const e=this.response.issueUrl,t=this.response.issueId;return this.$t("reporter.form.issue.link",{issueLink:e,issueId:t})}},data(){return{errors:[],response:{},loading:!1,previewClicked:!1,dirty:!0,previewData:{},issue:{title:null,formFields:{}}}},mounted(){const e=this.$el.querySelectorAll(".vue-tab")[1];e.addEventListener("click",()=>{this.previewClicked&&this.loadPreview(),this.previewClicked=!0}),e.addEventListener("mouseenter",()=>{this.dirty&&this.loadPreview()}),this.$el.querySelectorAll(".vue-tab")[0].addEventListener("click",()=>{this.dirty=!1,this.previewClicked=!1})},methods:{somethingChanged(){this.dirty=!0},loadPreview(){this.$api.post("reporter/report?preview=true",this.issue).then(t=>{this.previewData=t,this.dirty=!1})},checkForm(){this.errors=[],!this.issue.title&&this.issue.title<3&&this.errors.push(this.$t("reporter.form.error.title")),this.errors.length||this.submit()},submit(){this.loading=!0;const e=this.$api.post("reporter/report",this.issue);e.then(t=>{t.status>=200&&t.status<300?(this.response=t,this.issue={},this.$store.dispatch("notification/success",":)")):t.status===401?(this.errors.push(this.$t("reporter.form.error.authFailed")),this.response={}):t.status===400?(this.errors.push(t.message),this.response={}):t.status===404?(this.errors.push(this.$t("reporter.form.error.repoNotFound")),this.response={}):t.status===501?(this.errors.push(this.$t("reporter.form.error.platform.unsupported")),this.response={}):this.response={},this.loading=!1}),e.catch(t=>{this.errors.push(this.$t(t.message)),this.loading=!1,this.response={}})}}},$={};var j=h(P,L,M,!1,D,null,null,null);function D(e){for(let t in $)this[t]=$[t]}var k=function(){return j.exports}(),q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("k-inside",[s("k-view",{staticClass:"k-issue-tracker-view"},[s("k-header",[e._v(e._s(e.$t("reporter.headline")))]),s("k-text",[e._v(e._s(e.$t("reporter.description")))]),s("issue-form",{attrs:{fields:e.fields}})],1)],1)},N=[];const V={components:{IssueForm:k},props:{fields:Object},data(){return{fields:{}}},async created(){this.$api.get("reporter/fields").then(e=>{this.fields=e})}},g={};var U=h(V,q,N,!1,A,null,null,null);function A(e){for(let t in g)this[t]=g[t]}var X=function(){return U.exports}(),z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("header",{staticClass:"k-section-header"},[s("k-headline",[e._v(" "+e._s(e.headline)+" ")])],1),s("issue-form",{attrs:{fields:e.fields}})],1)},H=[],Q="";const W={components:{IssueForm:k},props:{fields:Object,headline:String},data(){return{fields:{}}},async created(){this.$api.get("reporter/fields").then(e=>{this.fields=e})}},w={};var B=h(W,z,H,!1,G,null,null,null);function G(e){for(let t in w)this[t]=w[t]}var J=function(){return B.exports}();panel.plugin("gearsdigital/kirby-reporter",{components:{"k-reporter-view":X},sections:{reporter:J}})})();})();
